<!DOCTYPE html>
<html>

<head>
    <meta charset=utf-8 />
    <title>The Great Map of Brews</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.mapbox.com/mapbox.js/v3.1.1/mapbox.js'></script>
    <link href='https://api.mapbox.com/mapbox.js/v3.1.1/mapbox.css' rel='stylesheet' />
    <script src='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.3.1/leaflet-omnivore.min.js'></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css?family=Cabin+Sketch|Comfortaa|Roboto" rel="stylesheet">

    <link href="/static/css/easy-button.css" rel="stylesheet">
    <script src="/static/js/easy-button.js"></script>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://domoritz.github.io/leaflet-locatecontrol/dist/L.Control.Locate.min.css" />
    <script src="https://domoritz.github.io/leaflet-locatecontrol/dist/L.Control.Locate.min.js" charset="utf-8"></script>
    <link rel="stylesheet" href="/static/css/MarkerCluster.css" />
    <link rel="stylesheet" href="/static/css/MarkerCluster.Default.css" />
    <script src="/static/js/leaflet.markercluster.js" charset="utf-8"></script>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="/static/css/L.Control.Sidebar.css" />
    <link rel="stylesheet" type="text/scss" href="/static/css/L.Control.Sidebar.scss" />
    <script src="/static/js/L.Control.Sidebar.js" charset="utf-8"></script>
    <!--
    <link rel="stylesheet" href="/static/css/leaflet-sidebar.css" />
    <script src="/static/js/L.Control.Sidebar.js" charset="utf-8"></script>
    <script src="/static/js/leaflet-sidebar.js" charset="utf-8"></script>
     -->
    <link rel="stylesheet" href="/static/css/main.css" />
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link href="https://fonts.googleapis.com/css?family=Ewert" rel="stylesheet">
    <script src="/static/js/main.js"></script>

</head>
<body>

    <div class="w3-card" id='map'> </div>

    <div id="sidebar">
        <div class="w3-bar w3-black">
            <button class="w3-bar-item w3-button tablink" onclick="openTab('event', 'brewery')">Brewery</button>
            <button class="w3-bar-item w3-button tablink" onclick="openTab('event', 'about')">About</button>
            <button class="w3-bar-item w3-button tablink" onclick="openTab(event, 'sign-up')">Sign Up</button>
            <button class="w3-bar-item w3-button tablink" onclick="openTab(event, 'sign-in')">Sign In</button>
            <button class="w3-bar-item w3-button tablink" onclick="sign_out()">Sign Out</button>
        </div>
        <div id="sign-up" class="w3-container w3-card Tab w3-margin-top">
            <ul id class="w3-container form">
                <p>
                    <li>
                        <input class="w3-input" type="text" id="email_signup" />
                    </li>
                    <label>Email</label>
                </p>
                <p>
                    <li>
                        <input class="w3-input" type="text" id="username_signup" />
                    </li>
                    <label>Username</label>
                </p>
                <p>
                    <li>
                        <input class="w3-input" type="text" id="password_signup" />
                    </li>
                    <label>Password</label>
                </p>
                <p>
                    <li>
                        <input class="w3-input" type="text" id="re_password_signup" />
                    </li>
                    <label>Retype password</label>
                </p>
                <li>
                    <button class="w3-button w3-section w3-grey" onclick="users('signUp')">Submit</button>
                </li>
            </ul>
        </div>
        <div id="sign-in" style="display:none" class="w3-container w3-card Tab w3-margin-top">
            <ul class="w3-container form">
                <p>
                    <li>
                        <input class="w3-input" type="text" id="email_login" />
                    </li>
                    <label>Email</label>
                </p>
                <p>
                    <li>
                        <input class="w3-input" type="text" id="username_login" />
                    </li>
                    <label>Username</label>
                </p>
                <p>
                    <li>
                        <input class="w3-input" type="text" id="password_login" />
                    </li>
                    <label>Password</label>
                </p>
                <li>
                    <button class="w3-button w3-section w3-grey" onclick="users('signIn')">Submit</button>
                </li>
            </ul>
        </div>
        <div id="brewery" class="w3-container w3-card Tab w3-margin-top">
                <table class="w3-table-all" id="brewery_select" style="width:100%"> </table>
        </div>

        <div id="about" class="w3-container w3-card Tab w3-margin-top">
            <h1>What is the great map of Brews?</h1>
            <p>Do you like beer? Do you lke maps and data? If so you've come to the right place. You can use this map to track
                where you've been, rate breweries and see your current location in relation to nearby breweries.</p>
        </div>
    </div>


    <script>
        L.mapbox.accessToken = 'pk.eyJ1Ijoic2FtZG90c29uMTk5MiIsImEiOiJRc2VOSXpvIn0.Bhg-j6XJ2sQGI48SjKOuYg';
        var map = L.mapbox.map('map', 'mapbox.streets').setView([38.03785, -84.850783], 3);

        var sidebar = L.control.sidebar('sidebar', {
            position: 'right'
        });

        map.addControl(sidebar);

        sidebar.toggle();

        map.addControl(L.control.locate({
            locateOptions: {
                maxZoom: 10
            }

        }));

        var beer = omnivore.csv("/static/datasets/Breweries.csv", null, L.mapbox.featureLayer()).on("ready", function () {
            var markers = L.markerClusterGroup({
                chunkedLoading: true
            });

            markers.addLayer(beer);
            markers.bindPopup(function (layer) {
                name =  layer.feature.properties.name
                return name
            }).on('click', get_brewery).addTo(map);
        });
        
        /*
    function get_brewery(name) {
    $.ajax({
        url: "get_brewery/" + name,
        type: 'GET',
        dataType: 'json',
        success(response) {
            console.log("It's respoinsing ": response);
            var data = JSON.parse(response);
                    console.log("this is the data: " data);
            document.getElementById("brewery_select").innerHTML =data
        },
        error(jqXHR, status, errorThrown) {
            console.log(status);
            console.log("No response from get_brewery");
            console.log(errorThrown);
        }
    });
}
*/

//This is where the Maddness is!

function get_brewery(event){
    var name = event.layer.feature.properties.name
       $.ajax({
                url: "get_brewery/"+name,
                type: 'GET',
                dataType: 'json',
                success(response) {
                    console.log(response);
                    var data = JSON.parse(response);
                    console.log(data);
                    list = "<tr><th>Name</th><th> Latitude</th><th>Longitude</th>";
                    for (i in data) {
                        list += "<tr><th>" + (data[i].name) + "</th><th>" + (data[i].latitude) + "</th><th>" + (data[i].longitude) + "</th></tr>"
                    }
                    document.getElementById("brewery_select").innerHTML =list;
                },
                error(jqXHR, status, errorThrown) {
                    console.log(status);
                    console.log("No response from get_brewery");
                    console.log(errorThrown);
                }
            })
        }

        L.easyButton('fa-home', function () {
            map.setView([38.03785, -84.850783], 4);
        }).addTo(map);
    </script>
</body>

</html>